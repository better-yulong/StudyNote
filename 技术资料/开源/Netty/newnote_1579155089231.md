

    DynamicDataSource(AbstractRoutingDataSource).determineTargetDataSource() line: 204	--- Spring提供AbstractRoutingDataSource 动态根据determineCurrentLookupKey值获取数据源
	DynamicDataSource.determineCurrentLookupKey() line: 17	 -- 获取自定义数据源key
	DynamicDataSource(AbstractRoutingDataSource).determineTargetDataSource() line: 196	
	DynamicDataSource(AbstractRoutingDataSource).getConnection() line: 164	
	DataSourceUtils.doGetConnection(DataSource) line: 111	
	DataSourceUtils.getConnection(DataSource) line: 77	
	SpringManagedTransaction.openConnection() line: 82	
	SpringManagedTransaction.getConnection() line: 68	
	SimpleExecutor(BaseExecutor).getConnection(Log) line: 336	
	SimpleExecutor.prepareStatement(StatementHandler, Log) line: 84	
	SimpleExecutor.doQuery(MappedStatement, Object, RowBounds, ResultHandler, BoundSql) line: 62	
	SimpleExecutor(BaseExecutor).queryFromDatabase(MappedStatement, Object, RowBounds, ResultHandler, CacheKey, BoundSql) line: 324	
	SimpleExecutor(BaseExecutor).query(MappedStatement, Object, RowBounds, ResultHandler, CacheKey, BoundSql) line: 156	
	CachingExecutor.query(MappedStatement, Object, RowBounds, ResultHandler, CacheKey, BoundSql) line: 109	
	PageInterceptor.intercept(Invocation) line: 141	
	Plugin.invoke(Object, Method, Object[]) line: 61	
	$Proxy208.query(MappedStatement, Object, RowBounds, ResultHandler) line: not available	
	DefaultSqlSession.selectList(String, Object, RowBounds) line: 148	
	DefaultSqlSession.selectList(String, Object) line: 141	
	DefaultSqlSession.selectOne(String, Object) line: 77	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 62	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 498	
	SqlSessionTemplate$SqlSessionInterceptor.invoke(Object, Method, Object[]) line: 433	
	$Proxy129.selectOne(String, Object) line: not available	
	SqlSessionTemplate.selectOne(String, Object) line: 166	
	MapperMethod.execute(SqlSession, Object[]) line: 82	
	MapperProxy<T>.invoke(Object, Method, Object[]) line: 59	
	$Proxy133.merchantLogin(String, String) line: not available	
	LoginServiceImpl.merchantLogin(LoginDto) line: 59	



public class DynamicDataSource extends AbstractRoutingDataSource {
	
	@Override
	protected Object determineCurrentLookupKey() {
		return CountryCodeHolder.getCountryCode().toLowerCase() + "DataSource";
	}
}

Spring提供AbstractRoutingDataSource 用于数据源路由扩展determineTargetDataSource，即根据上面determineCurrentLookupKey返回值从resolvedDataSources 集合中获取对应的数据源。
	protected DataSource determineTargetDataSource() {
		Assert.notNull(this.resolvedDataSources, "DataSource router not initialized");
		Object lookupKey = determineCurrentLookupKey();
		DataSource dataSource = this.resolvedDataSources.get(lookupKey);
		if (dataSource == null && (this.lenientFallback || lookupKey == null)) {
			dataSource = this.resolvedDefaultDataSource;
		}
		if (dataSource == null) {
			throw new IllegalStateException("Cannot determine target DataSource for lookup key [" + lookupKey + "]");
		}
		return dataSource;
	}


